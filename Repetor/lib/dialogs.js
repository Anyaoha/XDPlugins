const{getManifest:getManifest,getNearestIcon:getNearestIcon}=require("./manifest.js");let manifest;function strToHtml(t){if(Array.isArray(t))return t.map(t=>strToHtml(t)).join("");if("string"!=typeof t)return strToHtml(`${t}`);let n=t;n="##"===n.substr(0,2)?`<h3>${n.substr(2).trim().toUpperCase()}</h3>`:"#"===n.substr(0,1)?`<h2>${n.substr(1).trim()}</h2>`:"* "===n.substr(0,2)?`<p class="list"><span class="bullet margin">â€¢</span><span class="margin">${n.substr(2).trim()}</span></p>`:"----"===n.substr(0,4)?`<hr class="small"/>${n.substr(5).trim()}`:"---"===n.substr(0,3)?`<hr/>${n.substr(4).trim()}`:`<p>${n.trim()}</p>`;const e=/\[([^\]]*)\]\(([^\)]*)\)/,r=t.match(e);if(r){const t=r[1];n=`<p><a href="${r[2]}">${n.replace(e,t).replace(/\<\|?p\>/g,"")}</a></p>`}return n}async function createDialog({title:t,icon:n="plugin-icon",msgs:e,prompt:r,multiline:a=!1,render:i,template:s,isError:l=!1,buttons:o=[{label:"Close",variant:"cta",type:"submit"}]}={},c=360,p="auto",m=18){let u=Array.isArray(e)?e:[e];try{manifest||(manifest=await getManifest())}catch(t){}let g=!1;"plugin-icon"===n&&manifest.icons&&(g=!0,n=getNearestIcon(manifest,m=24));const f=document.createElement("dialog");f.innerHTML=`\n<style>\n    form {\n        width: ${c}px;\n    }\n    .h1 {\n        display: flex;\n        flex-direction: row;\n        justify-content: space-between;\n        align-items: center;\n    }\n    .h1 img {\n        width: ${m}px;\n        height: ${m}px;\n        flex: 0 0 ${m}px;\n        padding: 0;\n        margin: 0;\n    }\n    img.plugin-icon {\n        border-radius: 4px;\n        overflow: hidden;\n    }\n    .list {\n        display: flex;\n        flex-direction: row;\n    }\n    .list .margin {\n        margin-bottom: 0;\n        margin-left: 0;\n    }\n    .list span {\n        flex: 0 0 auto;\n        border: 1px solid transparent;\n    }\n    .list .bullet {\n        text-align: center;\n    }\n    .list + .list {\n        margin-top: 0;\n    }\n    textarea {\n        height: 200px;\n    }\n    .container {\n        zoverflow-x: hidden;\n        overflow-y: auto;\n        height: ${"auto"===p?p:`${p}px`};\n    }\n</style>\n<form method="dialog">\n    <h1 class="h1">\n        <span ${l?'class="color-red"':""}>${t}</span>\n        ${n?`<img ${g?`class="plugin-icon" title="${manifest.name}"`:""} src="${n}" />`:""}\n    </h1>\n    <hr />\n    <div class="container">\n        ${!i&&(s?s():u.map(t=>strToHtml(t)).join("")+(r?`<label>${a?`<textarea id="prompt" placeholder="${r}"></textarea>`:`<input type="text" id="prompt" placeholder="${r}" />`}</label>`:""))}\n    </div>\n    <footer>\n        ${o.map(({label:t,type:n,variant:e}={},r)=>`<button id="btn${r}" type="${n}" uxp-variant="${e}">${t}</button>`).join("")}\n    </footer>\n</form>\n    `,i&&f.querySelector(".container").appendChild(i());let b=-1,h=-1,d=-1;f.querySelector("form").onsubmit=(()=>f.close("ok")),o.forEach(({type:t,variant:n}={},e)=>{const r=f.querySelector(`#btn${e}`);"submit"!==t&&"cta"!==n||(b=e),"reset"===t&&(h=e),r.onclick=(t=>{t.preventDefault(),d=e,f.close(e===h?"reasonCanceled":"ok")})});try{return document.appendChild(f),"reasonCanceled"===await f.showModal()?{which:h,value:""}:(-1===d&&(d=b),{which:d,value:r?f.querySelector("#prompt").value:""})}catch(t){return{which:h,value:""}}finally{f.remove()}}async function alert(t,...n){return createDialog({title:t,msgs:n})}async function error(t,...n){return createDialog({title:t,isError:!0,msgs:n})}async function confirm(t,n,e=["Cancel","OK"]){return createDialog({title:t,msgs:[n],buttons:[{label:e[0],type:"reset",variant:"primary"},{label:e[1],type:"submit",variant:"cta"}]})}async function warning(t,n,e=["Cancel","OK"]){return createDialog({title:t,msgs:[n],buttons:[{label:e[0],type:"submit",variant:"primary"},{label:e[1],type:"button",variant:"warning"}]})}async function prompt(t,n,e,r=["Cancel","OK"],a=!1){return createDialog({title:t,msgs:[n],prompt:e,multiline:a,buttons:[{label:r[0],type:"reset",variant:"primary"},{label:r[1],type:"submit",variant:"cta"}]})}module.exports={createDialog:createDialog,alert:alert,error:error,confirm:confirm,warning:warning,prompt:prompt};