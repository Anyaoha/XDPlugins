const Helpers=require("../util/helpers");let indexes=[],enableBtn=function(e){setTimeout(()=>{e.disabled=!1},500)},extractContent=function(e){let t=[];return e.cellContent.items.forEach(a=>{indexes=a.parents.concat([a.index]);let r=[];e._rg.children.every((e,t)=>{let n=e;if(indexes.forEach(e=>{n=n.children.at(e)}),"image"===a.type.toLowerCase()){if(a.unclickable)return!1;r.push({data:n.fill,id:a.id,index:t,type:a.type})}else r.push({data:n.text,id:a.id,index:t,type:a.type});return!0}),t.push(r)}),t.reduce((e,t)=>e.concat(t),[]).groupBy("index")},setSiblings=function(e,t){let a=[];for(let r=0;r<Object.keys(e).length;r++){let n={id:t.selectedItem.id,siblings:[]};e[r].forEach(e=>{e.id===t.selectedItem.id?n.data=e.data:n.siblings.push({data:e.data,id:e.id,type:e.type})}),a.push(n)}return a},getApplyArrays=function(e){let t=e.map(e=>e.data),a=[];for(let t=0;t<e[0].siblings.length;t++){let r={id:"",type:"",data:[]};e.forEach(e=>{e.siblings.forEach((e,a)=>{a===t&&(r.id=e.id,r.type=e.type,r.data.push(e.data))})}),a.push(r)}return{main:t,siblings:a}};function ReorderService(){this.View="partial/reorder/view"}ReorderService.prototype.GetView=function(){return Helpers.GetHtmlTemplate(this.View)},ReorderService.prototype.Reorder=function(e,t,a,r,n){let i=[],s=e._rg;if(r?i=setSiblings(extractContent(e),e):(indexes=e.selectedItem.parents.concat([e.selectedItem.index]),s.children.forEach(e=>{let t=e;indexes.forEach(e=>{t=t.children.at(e)}),"text"!==t.constructor.name.toLowerCase()?i.push(t.fill):i.push(t.text)})),"image"===t)i.shuffle();else switch(t.toLowerCase()){case"number":"random"===a.toLowerCase()?i.shuffle():"ascending"===a.toLowerCase()?r?i.numSort("data"):i.numSort():r?i.numSort("data").reverse():i.numSort().reverse();break;case"date":"random"===a.toLowerCase()?i.shuffle():"ascending"===a.toLowerCase()?r?i.dateSort("data",!0):i.dateSort(void 0,!0):r?i.dateSort("data",!0).reverse():i.dateSort(void 0,!0).reverse();break;default:"random"===a.toLowerCase()?i.shuffle():"ascending"===a.toLowerCase()?r?i.textSort("data"):i.textSort():r?i.textSort("data").reverse():i.textSort().reverse()}if(r){let a=getApplyArrays(i);"image"===t?(s.attachImageDataSeries(e.selectedItem.sceneNode,a.main),enableBtn(n)):(s.attachTextDataSeries(e.selectedItem.sceneNode,a.main),enableBtn(n)),a.siblings.forEach(t=>{let a=e.cellContent.items.filter(e=>e.id===t.id)[0];"image"===t.type.toLowerCase()?(s.attachImageDataSeries(a.sceneNode,t.data),enableBtn(n)):(s.attachTextDataSeries(a.sceneNode,t.data),enableBtn(n))})}else"image"===t?(s.attachImageDataSeries(e.selectedItem.sceneNode,i),enableBtn(n)):(s.attachTextDataSeries(e.selectedItem.sceneNode,i),enableBtn(n))},module.exports=new ReorderService;