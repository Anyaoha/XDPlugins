const Config=require("../config/production").Main,Helpers=require("../util/helpers"),maxRepeatGridMockDimensions=Config.RG_MOCK_DIMENSIONS,repeatGridMockSpacing=Config.RG_MOCK_SPACING,cellContentClass=Config.CELL_CLASS;let repeatGrid,rgCell,size,dropDownSelect,itemClickCallback,parentIndexes=[],cellItemClick=function(e){if(!e.selected){let l=$all(".rg-content-btn-selected");for(var t of l)t.className=cellContentClass;repeatGrid.cellContent.items.forEach(e=>{e.selected=!1}),setTimeout(()=>{dropDownSelect.value=e.id,dropDownSelect.options.some((t,l)=>{if(t.value===e.id)return t.selected=!0,t.setAttribute("selected",!0),dropDownSelect.selectedIndex=l,!0})},50),this.className=this.className+" rg-content-btn-selected",e.selected=!0,repeatGrid.selectedItem=e,itemClickCallback()}},ddSelectChange=function(){let e,t=this;repeatGrid.cellContent.items.some(l=>{if(l.id===t.value)return e=l,!0}),cellItemClick.call(e.htmlElement,e)},setSize=function(e){let t=Math.min(size.width/rgCell.boundsInParent.width,size.height/rgCell.boundsInParent.height);e.htmlElement.style.width=e.sceneNode.boundsInParent.width*t,e.htmlElement.style.height=e.sceneNode.boundsInParent.height*t,e.sceneNode.boundsInParent.y<rgCell.localBounds.y?e.htmlElement.style.top=e.sceneNode.boundsInParent.y*t+repeatGridMockSpacing:e.htmlElement.style.top=(e.sceneNode.boundsInParent.y-rgCell.localBounds.y)*t+repeatGridMockSpacing,e.sceneNode.boundsInParent.x<rgCell.localBounds.x?e.htmlElement.style.left=e.sceneNode.boundsInParent.x*t+repeatGridMockSpacing:e.htmlElement.style.left=(e.sceneNode.boundsInParent.x-rgCell.localBounds.x)*t+repeatGridMockSpacing},generateCellItem=function(e,t,l){let n=Math.min(size.width/rgCell.boundsInParent.width,size.height/rgCell.boundsInParent.height),i={parents:parentIndexes.slice(0),index:t,id:e.guid,name:e.name,sceneNode:e,htmlElement:$create("div")};if("RepeatGrid"===e.constructor.name)i.unclickable=!0,i.type="RepeatGrid";else if("Text"===e.constructor.name)i.type="Text";else if(i.type="Image",!l||e.fillEnabled&&!e.fill.value||(i.unclickable=!0),"Ellipse"===e.constructor.name)i.htmlElement.style.borderRadius="50%";else if("Rectangle"===e.constructor.name&&e.hasRoundedCorners){var r=e.cornerRadii;i.htmlElement.style.borderTopLeftRadius=parseFloat(r.topLeft)*n,i.htmlElement.style.borderTopRightRadius=parseFloat(r.topRight)*n,i.htmlElement.style.borderBottomRightRadius=parseFloat(r.bottomRight)*n,i.htmlElement.style.borderBottomLeftRadius=parseFloat(r.bottomLeft)*n}i.htmlElement.className=cellContentClass,"Image"===i.type?i.htmlElement.className+=" image":i.htmlElement.className+=" text";let o=e.boundsInParent.width/e.boundsInParent.height;i.orientation=o<.9?"portrait":o>1.1?"landscape":"squarish",i.unclickable&&(i.htmlElement.disabled=!0,i.htmlElement.style.opacity=0,i.htmlElement.style.visibility="hidden");let a=$create("option"),c="";return c=i.name.length>20?i.name.substr(0,20)+"...":i.name.substr(0,20),a.innerHTML=`${c} (${i.type})`,a.value=i.id,i.unclickable||dropDownSelect.appendChild(a),dropDownSelect.addEventListener("change",ddSelectChange),i.unclickable||i.htmlElement.addEventListener("click",function(){cellItemClick.call(this,i)}),i},unwrapCellTree=function(e,t,l){parentIndexes.push(t),e.forEach((e,t)=>{if("Group"===e.constructor.name)return unwrapCellTree(e.children,t,l);{let n=generateCellItem(e,t,l);setSize(n),repeatGrid.cellContent.htmlElement.appendChild(n.htmlElement),repeatGrid.cellContent.items.push(n)}}),parentIndexes.pop()};function MockService(){}MockService.prototype.FakeIt=function(e,t,l,n,i,r){let o=t||maxRepeatGridMockDimensions;rgCell=(repeatGrid=e)._rg.children.at(0),size=Helpers.ResizeProportionally(rgCell.boundsInParent.width,rgCell.boundsInParent.height,o.width),itemClickCallback=i,(dropDownSelect=n).innerHTML="",l.innerHTML="",dropDownSelect.removeEventListener("change",ddSelectChange),repeatGrid.cellContent.htmlElement=l,repeatGrid.cellContent.htmlElement.innerHTML="",repeatGrid.cellContent.htmlElement.style.width=size.width+2*repeatGridMockSpacing,repeatGrid.cellContent.htmlElement.style.height=size.height+2*repeatGridMockSpacing,repeatGrid.cellContent.items=[],rgCell.children.forEach((e,t)=>{if(parentIndexes.length=0,"Group"!==e.constructor.name){let l=generateCellItem(e,t,r);setSize(l),repeatGrid.cellContent.htmlElement.appendChild(l.htmlElement),repeatGrid.cellContent.items.push(l)}else unwrapCellTree(e.children,t,r)})},MockService.prototype.Resize=function(e,t){size=Helpers.ResizeProportionally(rgCell.boundsInParent.width,rgCell.boundsInParent.height,t.width),e.cellContent.htmlElement.style.width=size.width+2*repeatGridMockSpacing,e.cellContent.htmlElement.style.height=size.height+2*repeatGridMockSpacing,e.cellContent.items.forEach(function(e){setSize(e)})},MockService.prototype.SelectFirst=function(){let e=repeatGrid.cellContent.items.filter(e=>!e.unclickable)[0];e&&cellItemClick.call(e.htmlElement,e)},MockService.prototype.Unbind=function(){repeatGrid=void 0,rgCell=void 0,size=void 0,dropDownSelect=void 0,itemClickCallback=void 0,parentIndexes.length=[]},module.exports=MockService;