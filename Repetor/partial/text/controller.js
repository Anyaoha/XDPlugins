const storage=require("uxp").storage,fs=storage.localFileSystem,{editDocument:editDocument}=require("application"),faker=require("../../lib/faker"),moment=require("../../lib/moment"),Config=require("../../config/production").Texts,Usage=require("../../service/UsageService"),TextService=require("../../service/TextService"),Helpers=require("../../util/helpers"),Separator=require("../../util/separator"),SortingService=require("../../service/SortingService"),view="partial/text/view",customListView="partial/text/custom-list/custom-list-view",dateView="partial/text/date/date-view";let Sort,searchTextCategory,textCategories,categoryDetails,backButton,addBtn,outputExample,gridSize,RepeatGrid,localeSelect,selectedTextType,textTypeOptionsContainer,localeContainer,prefixSuffix,prefixSuffixEg,prefixInput,suffixInput,chooseListFileBtn,listTextarea,separatorSelect,resultItems,resultLabel,customListFinalItems,customListRemovedItems,dateFormatSelect,dateFormatInput,datePeriodSelect,dateFormatInputLabel,datePeriodSelectLabel,tokens,dateExample,CATEGORIES=[],changeLocale=function(){Usage.TextChangeLocale(this.value),faker.locale=this.value,moment.locale(this.value),selectedTextType&&changeTextType(selectedTextType)},getPriceFormats=function(){return[{text:`Currency, Value - ${TextService.PRICE_DEF.curr}${faker.commerce.price(TextService.PRICE_DEF.min,TextService.PRICE_DEF.max,0)}`,value:"CURR+VAL 0"},{text:`Currency, Value, 1 Decimal - ${TextService.PRICE_DEF.curr}${faker.commerce.price(TextService.PRICE_DEF.min,TextService.PRICE_DEF.max,1)}`,value:"CURR+VAL 1"},{text:`Currency, Value, 2 Decimals - ${TextService.PRICE_DEF.curr}${faker.commerce.price(TextService.PRICE_DEF.min,TextService.PRICE_DEF.max,2)}`,value:"CURR+VAL 2"},{text:`Value, Currency - ${faker.commerce.price(TextService.PRICE_DEF.min,TextService.PRICE_DEF.max,0)}${TextService.PRICE_DEF.curr}`,value:"VAL+CURR 0"},{text:`Value, 1 Decimal, Currency - ${faker.commerce.price(TextService.PRICE_DEF.min,TextService.PRICE_DEF.max,1)}${TextService.PRICE_DEF.curr}`,value:"VAL+CURR 1"},{text:`Value, 2 Decimals, Currency - ${faker.commerce.price(TextService.PRICE_DEF.min,TextService.PRICE_DEF.max,2)}${TextService.PRICE_DEF.curr}`,value:"VAL+CURR 2"}]},getPriceBoxes=function(e){let t=$create("div"),a=$create("div"),r=$create("div"),i=$create("div");a.style.marginTop="10px",r.style.marginTop="10px",i.style.marginTop="10px";let s=$create("div");s.setAttribute("class","strong"),s.innerHTML="Select format";let n=$create("div");n.setAttribute("class","strong"),n.innerHTML="Minimum";let c=$create("div");c.setAttribute("class","strong"),c.innerHTML="Maximum";let o=$create("div");o.setAttribute("class","strong"),o.innerHTML="Currency";let l=$create("select"),d=getPriceFormats();d.forEach(function(e){let t=$create("option");t.innerHTML=e.text,t.value=e.value,l.appendChild(t)});let u=$create("input");u.setAttribute("type","number"),u.setAttribute("max",9999999),u.setAttribute("min",-9999999),u.setAttribute("maxlength",8);let x=$create("input");x.setAttribute("type","number"),x.setAttribute("max",9999999),x.setAttribute("min",-9999999),x.setAttribute("maxlength",8);let h=$create("input");h.setAttribute("type","text"),h.setAttribute("placeholder","Default "+TextService.PRICE_DEF.curr),h.setAttribute("maxlength",4),t.appendChild(s),t.appendChild(l),a.appendChild(n),a.appendChild(u),r.appendChild(c),r.appendChild(x),i.appendChild(o),i.appendChild(h);let p=function(){e.call(this,l.value,u.value||TextService.PRICE_DEF.min,x.value||TextService.PRICE_DEF.max,h.value||TextService.PRICE_DEF.curr)};return l.addEventListener("change",p),l.onChange=p,u.addEventListener("focus",p),u.addEventListener("input",p),x.addEventListener("input",p),h.addEventListener("input",p),l.value=d[0].value,u.value=TextService.PRICE_DEF.min,x.value=TextService.PRICE_DEF.max,outputExample.appendChild(t),outputExample.appendChild(a),outputExample.appendChild(r),outputExample.appendChild(i),outputExample.style.display="block",outputExample},getNumberBoxes=function(e,t,a){let r,i=!1,s=$create("div"),n=$create("div"),c=$create("div");c.setAttribute("class","strong"),c.innerHTML="From";let o=$create("div");o.setAttribute("class","strong"),o.innerHTML="To";let l=$create("input");l.setAttribute("type","number"),l.setAttribute("min",-TextService.R_NO_DEF.to),l.setAttribute("max",TextService.R_NO_DEF.to),l.setAttribute("maxlength",5),l.value=TextService.R_NO_DEF.from;let d=$create("input");d.setAttribute("type","number"),d.setAttribute("min",-TextService.R_NO_DEF.to),d.setAttribute("max",TextService.R_NO_DEF.to),d.setAttribute("maxlength",5),d.value=TextService.R_NO_DEF.to;let u=function(){e.call(this,l.value||TextService.R_NO_DEF.from,d.value||TextService.R_NO_DEF.to,t?r.value||TextService.R_NO_DEF.dec:0,i)};if(l.addEventListener("focus",u),l.addEventListener("input",u),d.addEventListener("input",u),s.appendChild(c),s.appendChild(l),n.appendChild(o),n.appendChild(d),outputExample.appendChild(s),a){let e=$create("div"),t=$create("button"),a=$create("img");t.setAttribute("uxp-variant","action"),t.setAttribute("title","Consecutive"),a.setAttribute("src","images/consecutive.png"),t.appendChild(a);let r=function(){this.selected?(this.selected=!1,this.setAttribute("uxp-selected",!1)):(this.selected=!0,this.setAttribute("uxp-selected",!0)),i=this.selected,u()};t.addEventListener("click",r),e.appendChild(t),outputExample.appendChild(e)}if(outputExample.appendChild(n),t){let e=$create("div"),t=$create("div");t.setAttribute("class","strong"),t.innerHTML="Decimals",(r=$create("input")).setAttribute("type","number"),r.setAttribute("min",0),r.setAttribute("max",9),r.setAttribute("maxlength",1),r.value=TextService.R_NO_DEF.dec,r.addEventListener("input",u),s.className="col-1",n.className="col-1",e.className="col-1",e.appendChild(t),e.appendChild(r),outputExample.appendChild(e)}else s.className="col-half",n.className="col-half";return outputExample.style.display="block",outputExample},createTextBox=function(e,t,a,r){let i=$create("div");i.setAttribute("class","strong"),i.innerHTML=e;let s=$create("input");return s.setAttribute("type","text"),s.setAttribute("placeholder",t),s.addEventListener("focus",a),s.addEventListener("input",function(e){isNaN(this.value)?this.value="":(this.value=parseInt(this.value),r&&this.value>r&&(this.value=r.toString())),a.call(this)}),r&&s.setAttribute("maxlength",r.toString().length),outputExample.appendChild(i),outputExample.appendChild(s),outputExample.style.display="block",outputExample},createSelect=function(e,t,a,r,i,s){let n=$create("div");n.setAttribute("class","strong"),n.innerHTML=e;let c=$create("select");return c.addEventListener("change",a),c.onChange=a,t.forEach(function(e){let t=$create("option");t.innerHTML=e.text,t.value=e.value,c.appendChild(t)}),c.value=t[i||0].value,outputExample.appendChild(n),outputExample.appendChild(c),outputExample.style.display="block",outputExample},createRadioMark=function(e,t,a,r,i){let s=$create("label");s.className=`top-row col-${e}`;let n=$create("div");n.innerHTML=`${t}<div class="small">${a}</div>`;let c=$create("input");return c.setAttribute("type","radio"),c.setAttribute("name",r),c.addEventListener("change",function(){outputExample.innerHTML="",outputExample.style.display="none",i.call(this)}),s.appendChild(c),s.appendChild(n),s},createCheckMark=function(e,t,a,r,i){let s=$create("label");s.className=`top-row col-${e}`;let n=$create("div");n.innerHTML=`${t}<div class="small">${a}</div>`;let c=$create("input");return c.setAttribute("type","checkbox"),c.addEventListener("change",function(){outputExample.innerHTML="",outputExample.style.display="none",r&&radioCheck.call(this),i.call(this)}),s.appendChild(c),s.appendChild(n),s},showExample=function(e,t){outputExample.innerHTML=`<small class="small">${e}</small><strong class="strong">${t}</strong>`,outputExample.style.display="block"},appendOptions=function(...e){e.forEach(e=>{textTypeOptionsContainer.appendChild(e)})},disableAll=function(e){localeSelect.disabled=e,prefixInput.disabled=e,suffixInput.disabled=e,RepeatGrid.cellContent.htmlElement.disabled=e,RepeatGrid.cellContent.items.forEach(t=>{t.htmlElement&&(t.htmlElement.disabled=e)});let t=textTypeOptionsContainer.childNodes;for(let a=0;a<t.length;a++){let r=t[a];r.disabled=e,r.firstChild&&(r.firstChild.disabled=e),r.childNodes[1]&&(r.childNodes[1].className=e?"disabled":"")}for(var a=$all("input"),r=0;r<a.length;r++)a[r].disabled=e;var i=$all("select");for(r=0;r<i.length;r++)i[r].disabled=e},radioCheck=function(){let e=textTypeOptionsContainer.childNodes;for(let t=0;t<e.length;t++){let a=e[t];"label"===a.tagName.toLowerCase()&&a.firstChild!==this&&(a.firstChild.checked=!1)}},prefixChange=function(){TextService.Prefix=this.value},suffixChange=function(){TextService.Suffix=this.value},hidePrefixSuffix=function(){prefixSuffix.style.display="none",prefixSuffixEg.innerHTML="",TextService.Prefix="",TextService.Suffix="",prefixInput.removeEventListener("input",prefixChange),suffixInput.removeEventListener("input",suffixChange),prefixInput.value="",suffixInput.value=""},showPrefixSuffix=function(){prefixSuffixEg.innerHTML=Helpers.Random(TextService.Texts).toString(),prefixInput.addEventListener("input",prefixChange),suffixInput.addEventListener("input",suffixChange),prefixSuffix.style.display="flex"},clearTexts=function(){hidePrefixSuffix(),outputExample.style.display="none",Sort.Reset(),TextService.ClearTexts()},generateAddresses=function(e){TextService.ClearTexts();let t="{{";if(e.map(function(e){switch(e){case"address.streetAddress":return"1. "+e;case"address.secondaryAddress":return"2. "+e;case"address.city":return"3. "+e;case"address.county":return"4. "+e;case"address.state":case"address.stateAbbr":return"5. "+e;case"address.zipCode":return"6. "+e;case"address.country":case"address.countryCode":return"7. "+e}}).sort().map(e=>e.split(" ")[1]).forEach((e,a)=>{if(0===a)t+=e+"}}";else switch(e){case"address.county":case"address.state":case"address.stateAbbr":case"address.country":case"address.countryCode":case"address.city":t+=", {{"+e+"}}";break;default:t+=" {{"+e+"}}"}}),"{{"!==t){showExample("Full address example:",faker.fake(t));for(let e=0;e<gridSize;e++)TextService.Texts.push(faker.fake(t));Usage.TextChangeSubCategory(e.map(function(e){switch(e){case"address.streetAddress":return"Street Address";case"address.secondaryAddress":return"Apt./Suite";case"address.city":return"City";case"address.county":return"County";case"address.state":return"State";case"address.stateAbbr":return"State Abbreviation";case"address.zipCode":return"Zip Code";case"address.country":return"Country";case"address.countryCode":return"Country Code"}}).join(", ")),TextService._TextsBack=TextService.Texts.slice()}},changeDatePeriod=function(e){outputExample.innerHTML="",outputExample.style.display="none";let t,a=dateFormatSelect.value,r=datePeriodSelect.value,i="recent"===r?90:5;switch(dateExample&&!0===e||(dateExample=moment(faker.date[r](i))),dateFormatSelect.value){case"custom":a=dateFormatInput.value,t=dateExample.format(a);break;case"relative":t=dateExample.from(moment());break;default:t=dateExample.format(a)}t&&showExample("Date example: ",t),Usage.TextChangeSubCategory(("past"===r?"Past Date":"recent"===r?"Recent Date":"Future Date")+"; FORMAT: "+a),TextService.GenerateDates(gridSize,a,r,i),Sort.ShowDate()},changeDateFormat=function(){clearTexts(),outputExample.innerHTML="",outputExample.style.display="none",dateFormatInputLabel.style.display="none",tokens.style.display="none","custom"===dateFormatSelect.value&&(dateFormatInputLabel.style.display="block",tokens.style.display="block",dateFormatInput.focus(),dateFormatInput.addEventListener("keydown",function(e){e.preventDefault()}),dateFormatInput.addEventListener("input",function(){let e=this.value.replace(/[0-9]/g,"");this.value=e,changeDatePeriod(!0)})),datePeriodSelectLabel.style.display="block",datePeriodSelect.value="recent",datePeriodSelect.addEventListener("change",changeDatePeriod),changeDatePeriod(!0)},changeTextType=function(e){switch(selectedTextType=e,localeContainer.style.display="none",textTypeOptionsContainer.innerHTML="",clearTexts(),Usage.TextChangeCategory(e),Usage.TextChangeSubCategory(""),e){case"address":{localeContainer.style.display="flex";let e=[],t=createCheckMark(1,"Geo Coordinates",faker.fake("{{address.latitude}}, {{address.longitude}}"),!0,function(){this.checked?(e.length=0,Usage.TextChangeSubCategory("Geo Coordinates"),TextService.GenerateTexts(gridSize,"fake","{{address.latitude}}, {{address.longitude}}")):clearTexts()}),a=createCheckMark(1,"City",faker.address.city(),!1,function(){if(t.firstChild.checked=!1,this.checked)e.push("address.city");else{clearTexts();let t=e.indexOf("address.city");t>-1&&e.splice(t,1)}generateAddresses(e)}),r=createCheckMark(1,"Street Address",faker.address.streetAddress(),!1,function(){if(t.firstChild.checked=!1,this.checked)e.push("address.streetAddress");else{clearTexts();let t=e.indexOf("address.streetAddress");t>-1&&e.splice(t,1)}generateAddresses(e)}),i=createCheckMark(1,"Apt./Suite",faker.address.secondaryAddress(),!1,function(){if(t.firstChild.checked=!1,this.checked)e.push("address.secondaryAddress");else{clearTexts();let t=e.indexOf("address.secondaryAddress");t>-1&&e.splice(t,1)}generateAddresses(e)}),s=createCheckMark(1,"County",faker.address.county(),!1,function(){if(t.firstChild.checked=!1,this.checked)e.push("address.county");else{clearTexts();let t=e.indexOf("address.county");t>-1&&e.splice(t,1)}generateAddresses(e)}),n=createCheckMark(1,"State",faker.address.state(),!1,function(){if(t.firstChild.checked=!1,this.checked){let t=e.indexOf("address.stateAbbr");t>-1&&e.splice(t,1),c.firstChild.checked=!1,e.push("address.state")}else{clearTexts();let t=e.indexOf("address.state");t>-1&&e.splice(t,1)}generateAddresses(e)}),c=createCheckMark(1,"State Abbreviation",faker.address.stateAbbr(),!1,function(){if(t.firstChild.checked=!1,this.checked){let t=e.indexOf("address.state");t>-1&&e.splice(t,1),n.firstChild.checked=!1,e.push("address.stateAbbr")}else{clearTexts();let t=e.indexOf("address.stateAbbr");t>-1&&e.splice(t,1)}generateAddresses(e)}),o=createCheckMark(1,"Zip Code",faker.address.zipCode(),!1,function(){if(t.firstChild.checked=!1,this.checked)e.push("address.zipCode");else{clearTexts();let t=e.indexOf("address.zipCode");t>-1&&e.splice(t,1)}generateAddresses(e)}),l=createCheckMark(1,"Country",faker.address.country(),!1,function(){if(t.firstChild.checked=!1,this.checked){let t=e.indexOf("address.countryCode");t>-1&&e.splice(t,1),d.firstChild.checked=!1,e.push("address.country")}else{clearTexts();let t=e.indexOf("address.country");t>-1&&e.splice(t,1)}generateAddresses(e)}),d=createCheckMark(1,"Country Code",faker.address.countryCode(),!1,function(){if(t.firstChild.checked=!1,this.checked){let t=e.indexOf("address.country");t>-1&&e.splice(t,1),l.firstChild.checked=!1,e.push("address.countryCode")}else{clearTexts();let t=e.indexOf("address.countryCode");e.splice(t,1)}generateAddresses(e)});appendOptions(i,a,l,d,s,t,n,c,r,o),r.click(),a.click(),c.click(),d.click()}break;case"commerce":{let t=createRadioMark(1,"Product",faker.commerce.product(),"commerce",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Product"),TextService.GenerateTexts(gridSize,e,"product"),showPrefixSuffix()):clearTexts()}),a=createRadioMark(1,"Product",faker.commerce.productName(),"commerce",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Product Name"),TextService.GenerateTexts(gridSize,e,"productName"),showPrefixSuffix()):clearTexts()}),r=createRadioMark(1,"Department",faker.commerce.department(),"commerce",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Department"),TextService.GenerateTexts(gridSize,e,"department"),showPrefixSuffix()):clearTexts()}),i=createRadioMark(1,"Price","$"+faker.commerce.price(),"commerce",function(){let e=TextService.PRICE_DEF.min,t=TextService.PRICE_DEF.max,a=TextService.PRICE_DEF.curr;if(this.checked){hidePrefixSuffix(),Sort.Reset();let r=getPriceBoxes(function(r,i,s,n){e=parseInt(i),t=parseInt(s),a=n,TextService.GeneratePrices(gridSize,r,e,t,a),Usage.TextChangeSubCategory("Price"),Sort.ShowNum()});r.childNodes[0].childNodes[1].focus(),r.childNodes[0].childNodes[1].onChange()}else clearTexts()}),s=createRadioMark(1,"Color",faker.commerce.color(),"commerce",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Color"),TextService.GenerateTexts(gridSize,e,"color"),showPrefixSuffix()):clearTexts()});appendOptions(s,r,i,t,a),s.click()}break;case"company":{let t=createRadioMark(1,"Company",faker.company.companyName(),"company",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Company Name"),TextService.GenerateTexts(gridSize,e,"companyName"),showPrefixSuffix()):clearTexts()}),a=createRadioMark(1,"Catch Phrase",faker.company.catchPhrase(),"company",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Catch Phrase"),TextService.GenerateTexts(gridSize,e,"catchPhrase"),showPrefixSuffix()):clearTexts()}),r=createRadioMark(1,"Business",faker.company.bs(),"company",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Business"),TextService.GenerateTexts(gridSize,e,"bs"),showPrefixSuffix()):clearTexts()});appendOptions(r,a,t),r.click()}break;case"date":Helpers.GetHtmlTemplate(dateView).then(e=>{(textTypeOptionsContainer=$first("#textTypeOptionsContainer")).innerHTML=e,dateFormatSelect=$first("#dateFormatSelect"),dateFormatInput=$first("#dateFormatInput"),datePeriodSelect=$first("#datePeriodSelect"),dateFormatInputLabel=$first("#dateFormatInputLabel"),datePeriodSelectLabel=$first("#datePeriodSelectLabel"),tokens=$first("#tokens"),dateFormatSelect.value="LL",dateFormatSelect.addEventListener("change",changeDateFormat),changeDateFormat()});break;case"finance":{let t=createRadioMark(1,"Account No.",faker.finance.account(),"finance",function(){this.checked?(Sort.Reset(),Sort.ShowNum(),Usage.TextChangeSubCategory("Account No."),TextService.GenerateTexts(gridSize,e,"account"),showPrefixSuffix()):clearTexts()}),a=createRadioMark(1,"Account",faker.finance.accountName(),"finance",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Account Name"),TextService.GenerateTexts(gridSize,e,"accountName"),showPrefixSuffix()):clearTexts()}),r=createRadioMark(1,"Amount",faker.finance.amount(TextService.R_NO_DEF.from,TextService.R_NO_DEF.to,TextService.R_NO_DEF.dec),"finance",function(){if(this.checked){Sort.Reset();let t=getNumberBoxes(function(t,a,r){Usage.TextChangeSubCategory("Amount"),TextService.GenerateTexts(gridSize,e,"amount",parseFloat(t),parseFloat(a),parseFloat(r)),Sort.ShowNum(),showPrefixSuffix()},!0);t.style.display="block",t.childNodes[0].childNodes[1].focus()}else clearTexts()}),i=createRadioMark(1,"Transaction Type",faker.finance.transactionType(),"finance",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Transaction Type"),TextService.GenerateTexts(gridSize,e,"transactionType"),showPrefixSuffix()):clearTexts()}),s=createRadioMark(2,"Bitcoin Address",faker.finance.bitcoinAddress(),"finance",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("Bitcoin Address"),TextService.GenerateTexts(gridSize,e,"bitcoinAddress"),showPrefixSuffix()):clearTexts()}),n=createRadioMark(2,"IBAN",faker.finance.iban(),"finance",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("IBAN"),TextService.GenerateTexts(gridSize,e,"iban"),showPrefixSuffix()):clearTexts()}),c=createRadioMark(1,"BIC",faker.finance.bic(),"finance",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("BIC"),TextService.GenerateTexts(gridSize,e,"bic"),showPrefixSuffix()):clearTexts()});appendOptions(a,t,r,c,s,n,i),a.click()}break;case"internet":{localeContainer.style.display="flex";let t=createRadioMark(1,"Username",faker.internet.userName(),"internet",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Username"),TextService.GenerateTexts(gridSize,e,"userName"),showPrefixSuffix()):clearTexts()}),a=createRadioMark(1,"Password",faker.internet.password(),"internet",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("Password"),TextService.GenerateTexts(gridSize,e,"password"),showPrefixSuffix()):clearTexts()}),r=createRadioMark(1,"Email",faker.internet.email(),"internet",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Email"),TextService.GenerateTexts(gridSize,e,"email"),showPrefixSuffix()):clearTexts()}),i=createRadioMark(1,"Website",faker.internet.domainName(),"internet",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Website"),TextService.GenerateTexts(gridSize,e,"domainName"),showPrefixSuffix()):clearTexts()}),s=createRadioMark(1,"Website URL",faker.internet.url(),"internet",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Website URL"),TextService.GenerateTexts(gridSize,e,"url"),showPrefixSuffix()):clearTexts()}),n=createRadioMark(1,"IP Address",faker.internet.ip(),"internet",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("IP Address"),TextService.GenerateTexts(gridSize,e,"ip"),showPrefixSuffix()):clearTexts()}),c=createRadioMark(2,"IPv6 Address",faker.internet.ipv6(),"internet",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("IPv6 Address"),TextService.GenerateTexts(gridSize,e,"ipv6"),showPrefixSuffix()):clearTexts()}),o=createRadioMark(1,"MAC Address",faker.internet.mac(),"internet",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("MAC Address"),TextService.GenerateTexts(gridSize,e,"mac"),showPrefixSuffix()):clearTexts()}),l=createRadioMark(2,"User Agent String",faker.internet.userAgent(),"internet",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("User Agent String"),TextService.GenerateTexts(gridSize,e,"userAgent"),hidePrefixSuffix()):clearTexts()}),d=createRadioMark(1,"Color",faker.internet.color(),"internet",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("Color"),TextService.GenerateTexts(gridSize,e,"color"),showPrefixSuffix()):clearTexts()}),u=createRadioMark(3,"Phrase",faker.hacker.phrase(),"internet",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("Phrase"),TextService.GenerateTexts(gridSize,"hacker","phrase"),hidePrefixSuffix()):clearTexts()});appendOptions(d,r,n,c,o,u,a,t,l,i,s),d.click()}break;case"lorem":{let t=createRadioMark(1,"Word",faker.lorem.word(),"lorem",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Word"),TextService.GenerateTexts(gridSize,e,"word"),showPrefixSuffix()):clearTexts()}),a=createRadioMark(1,"Words",faker.lorem.words(),"lorem",function(){if(this.checked){Sort.Reset(),createTextBox("Number of words","Default 3, maximum 25",function(){Usage.TextChangeSubCategory("Words"),TextService.GenerateTexts(gridSize,e,"words",this.value||3),Sort.ShowAlpha(),showPrefixSuffix()},25).childNodes[1].focus()}else clearTexts()}),r=createRadioMark(3,"Sentence",faker.lorem.sentence(),"lorem",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("Sentence"),TextService.GenerateTexts(gridSize,e,"sentence"),hidePrefixSuffix()):clearTexts()}),i=createRadioMark(3,"Paragraph",faker.lorem.paragraph(3),"lorem",function(){if(this.checked){Sort.Reset(),createTextBox("Number of sentences","Default 3, maximum 10",function(){Usage.TextChangeSubCategory("Paragraph"),TextService.GenerateTexts(gridSize,e,"paragraph",this.value||3),hidePrefixSuffix()},10).childNodes[1].focus()}else clearTexts()}),s=createRadioMark(3,"Paragraphs",faker.lorem.paragraphs(2),"lorem",function(){if(this.checked){Sort.Reset(),createTextBox("Number of paragraphs","Default 3, maximum 20",function(){Usage.TextChangeSubCategory("Paragraphs"),TextService.GenerateTexts(gridSize,e,"paragraphs",this.value||3),hidePrefixSuffix()},20).childNodes[1].focus()}else clearTexts()}),n=createRadioMark(1,"Slug",faker.lorem.slug(),"lorem",function(){if(this.checked){Sort.Reset(),createTextBox("Number of words","Default 3, maximum 25",function(){Usage.TextChangeSubCategory("Slug"),TextService.GenerateTexts(gridSize,e,"slug",this.value||3),Sort.ShowAlpha(),showPrefixSuffix()},25).childNodes[1].focus()}else clearTexts()});appendOptions(i,s,r,n,t,a),i.click()}break;case"name":{localeContainer.style.display="flex";let t,a=[{value:-1,text:"Both"},{value:0,text:"Female"},{value:1,text:"Male"}],r=createRadioMark(1,"First Name",faker.name.firstName(),"name",function(){this.checked?(Sort.Reset(),(t=createSelect("Select gender",a,function(){TextService.GenerateNames(gridSize,this.value,"firstName"),Usage.TextChangeSubCategory("First Name"),Sort.ShowAlpha(),showPrefixSuffix()},!0)).childNodes[1].focus(),t.childNodes[1].onChange()):clearTexts()}),i=createRadioMark(1,"Last Name",faker.name.lastName(),"name",function(){this.checked?(Sort.Reset(),(t=createSelect("Select gender",a,function(){TextService.GenerateNames(gridSize,this.value,"lastName"),Usage.TextChangeSubCategory("Last Name"),Sort.ShowAlpha(),showPrefixSuffix()},!0)).childNodes[1].focus(),t.childNodes[1].onChange()):clearTexts()}),s=createRadioMark(1,"Full Name",faker.name.findName(),"name",function(){this.checked?(Sort.Reset(),(t=createSelect("Select gender",a,function(){TextService.GenerateNames(gridSize,this.value,"findName"),Usage.TextChangeSubCategory("First and Last Name"),Sort.ShowAlpha(),showPrefixSuffix()},!0)).childNodes[1].focus(),t.childNodes[1].onChange()):clearTexts()}),n=createRadioMark(1,"Job Title",faker.name.jobTitle(),"name",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Job Title"),TextService.GenerateTexts(gridSize,e,"jobTitle"),showPrefixSuffix()):clearTexts()}),c=createRadioMark(1,"Job Area",faker.name.jobArea(),"name",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Job Area"),TextService.GenerateTexts(gridSize,e,"jobArea"),showPrefixSuffix()):clearTexts()}),o=createRadioMark(1,"Job Type",faker.name.jobType(),"name",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Job Type"),TextService.GenerateTexts(gridSize,e,"jobType"),showPrefixSuffix()):clearTexts()});appendOptions(r,i,s,c,n,o),r.click()}break;case"phone":{let t=createRadioMark("half","Phone Number",faker.phone.phoneNumber(),"phone",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("Phone Number"),TextService.GenerateTexts(gridSize,e,"phoneNumber")):clearTexts()}),a=createRadioMark("half","Phone Number Format",faker.phone.phoneFormats(),"phone",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("Phone Number Format"),TextService.GenerateTexts(gridSize,e,"phoneFormats")):clearTexts()});appendOptions(t,a),t.click()}break;case"random":{let t=createRadioMark(1,"Number",faker.random.number({min:TextService.R_NO_DEF.from,max:TextService.R_NO_DEF.to}),"random",function(){if(this.checked){Sort.Reset();let e=getNumberBoxes(function(e,t,a,r){Usage.TextChangeSubCategory("Number"),TextService.GenerateNumbers(gridSize,parseInt(e),t,r),Sort.ShowNum(),showPrefixSuffix()},!1,!0);e.style.display="block",e.childNodes[0].childNodes[1].focus()}else clearTexts()}),a=createRadioMark(2,"UUID",faker.random.uuid(),"random",function(){this.checked?(Sort.Reset(),Usage.TextChangeSubCategory("UUID"),TextService.GenerateTexts(gridSize,e,"uuid"),hidePrefixSuffix()):clearTexts()}),r=createRadioMark(1,"True/False",faker.random.boolean(),"random",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("True/False"),TextService.GenerateTexts(gridSize,e,"boolean"),showPrefixSuffix()):clearTexts()}),i=createRadioMark(1,"Locale",faker.random.locale(),"random",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Locale"),TextService.GenerateTexts(gridSize,e,"locale"),showPrefixSuffix()):clearTexts()}),s=createRadioMark(1,"Alphanumeric",faker.random.alphaNumeric(8),"random",function(){if(this.checked){Sort.Reset(),createTextBox("Length","Default 8, maximum 64",function(){Usage.TextChangeSubCategory("Alphanumeric"),TextService.GenerateTexts(gridSize,e,"alphaNumeric",this.value||8),showPrefixSuffix()},64).childNodes[1].focus()}else clearTexts()});appendOptions(s,i,t,a,r),s.click()}break;case"system":{let t=Helpers.GetExtensionList(),a=createRadioMark(2,"File Name",faker.system.commonFileName(),"system",function(){if(this.checked){Sort.Reset();let a=createSelect("Select an extension",t,function(){TextService.GenerateTexts(gridSize,e,"commonFileName",this.value),Usage.TextChangeSubCategory("File Name"),Sort.ShowAlpha(),showPrefixSuffix()},!0);a.childNodes[1].focus(),a.childNodes[1].onChange()}else clearTexts()}),r=createRadioMark(1,"File Type",faker.system.commonFileType(),"system",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("File Type"),TextService.GenerateTexts(gridSize,e,"commonFileType"),showPrefixSuffix()):clearTexts()}),i=createRadioMark(1,"File Extension",faker.system.commonFileExt(),"system",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("File Extension"),TextService.GenerateTexts(gridSize,e,"commonFileExt"),showPrefixSuffix()):clearTexts()}),s=createRadioMark(1,"Version Number",faker.system.semver(),"system",function(){this.checked?(Sort.Reset(),Sort.ShowAlpha(),Usage.TextChangeSubCategory("Version Number"),TextService.GenerateTexts(gridSize,e,"semver"),showPrefixSuffix()):clearTexts()});appendOptions(i,a,r,s),i.click()}break;case"customList":Helpers.GetHtmlTemplate(customListView).then(e=>{let t;textTypeOptionsContainer.innerHTML=e,chooseListFileBtn=$first("#chooseListFileBtn"),listTextarea=$first("#listTextarea"),separatorSelect=$first("#separatorSelect"),resultItems=$first("#resultItems"),resultLabel=$first("#resultLabel"),clearSeparators(),resultItems.innerHTML="",resultItems.setAttribute("class",""),resultLabel.style.color="transparent",separatorSelect.disabled=!0,listTextarea.addEventListener("keydown",function(e){e.preventDefault(),void 0!==t&&clearTimeout(t),t=setTimeout}),listTextarea.addEventListener("input",function(){t=setTimeout(generateSeparators,200)}),chooseListFileBtn.addEventListener("click",openTxtFile),separatorSelect.addEventListener("change",changeSeparator),listTextarea.focus()})}},openTxtFile=function(){fs.getFileForOpening({types:["txt"]}).then(function(e){e&&e.read().then(e=>{clearSeparators(),listTextarea.value=e,generateSeparators()})})},textsFromCustomList=function(){clearTexts();let e=Math.max(customListFinalItems.length,gridSize),t=customListFinalItems.reduce((e,t)=>e+t.weight,0);customListFinalItems.forEach(a=>{let r=100*a.weight/t,i=e*r/100;for(var s=0;s<Math.round(i);s++)TextService.Texts.push(a.label.trim())}),Usage.TextChangeSubCategory("Custom List"),TextService._TextsBack=TextService.Texts.slice(),Sort.Reset(),Sort.ShowCustom()},removeListItem=function(){let e=this.parentNode,t=e.getAttribute("data-item-id"),a=0;customListFinalItems.some((e,r)=>(a=r,e.id===t)),e.setAttribute("class","list-item removed-item"),e.querySelector("input").value="0",e.querySelector("input").disabled=!0,customListRemovedItems.push(customListFinalItems.splice(a,1)[0]),textsFromCustomList()},addListItem=function(){let e=this.parentNode,t=e.getAttribute("data-item-id"),a=0;customListRemovedItems.some((e,r)=>(a=r,e.id===t)),e.setAttribute("class","list-item"),e.querySelector("input").value="1",e.querySelector("input").disabled=!1,customListFinalItems.push(customListRemovedItems.splice(a,1)[0]),textsFromCustomList()},changeWeight=function(){let e,t=this.value,a=this.parentNode,r=a.getAttribute("data-item-id"),i=0;customListFinalItems.some((e,t)=>(i=t,e.id===r)),e=t?parseInt(t):TextService.MIN_WEIGHT,customListFinalItems[i].weight=e,a.setAttribute("data-item-weight",e),textsFromCustomList()},changeSeparator=function(){let e;switch(resultItems.innerHTML="",resultItems.setAttribute("class",""),resultLabel.style.color="transparent",customListFinalItems=[],customListRemovedItems=[],separatorSelect.value){case"none":e=[listTextarea.value];break;case"tab":e=listTextarea.value.split("\t");break;case"space":e=listTextarea.value.split(" ");break;case"newline":e=listTextarea.value.split(/[\r\n]+/);break;default:e=listTextarea.value.split(separatorSelect.value)}e.filter(e=>""!==e.trim()).forEach((e,t)=>{customListFinalItems.push({label:e,weight:TextService.MIN_WEIGHT,id:Helpers.GeneratePassword()});let a=$create("div");a.className="list-item",a.setAttribute("data-item-id",customListFinalItems[t].id),a.setAttribute("data-item-weight",customListFinalItems[t].weight);let r=$create("a");r.setAttribute("title","Remove item"),r.className="remove-btn",r.innerHTML="&#10005;",r.addEventListener("click",removeListItem);let i=$create("a");i.setAttribute("title","Add item"),i.className="add-btn",i.innerHTML="&#10011;",i.addEventListener("click",addListItem);let s=$create("div");s.className="full-flex the-item",s.innerHTML=customListFinalItems[t].label;let n=$create("input");n.setAttribute("type","number"),n.setAttribute("min",TextService.MIN_WEIGHT),n.setAttribute("max",TextService.MAX_WEIGHT),n.setAttribute("maxlength",TextService.MAX_WEIGHT.toString().length),n.value=TextService.MIN_WEIGHT,n.setAttribute("placeholder","weight"),n.className="weight-input",n.addEventListener("keydown",function(e){e.preventDefault()}),n.addEventListener("input",function(e){n.value<TextService.MIN_WEIGHT?n.value=TextService.MIN_WEIGHT:n.value>TextService.MAX_WEIGHT&&(n.value=TextService.MAX_WEIGHT)}),a.appendChild(i),a.appendChild(r),a.appendChild(s),a.appendChild(n),resultItems.appendChild(a)}),customListFinalItems.length&&separatorSelect.value&&"none"!==separatorSelect.value?(resultItems.setAttribute("class","stylized"),resultLabel.style.color="#444",textsFromCustomList()):Sort.Reset()},clearSeparators=function(){let e=separatorSelect.childNodes;if(e.length)for(let t=0;t<e.length;t++)"none"!==e[t].value&&e[t].remove();separatorSelect.value="none"},generateSeparators=function(){if(clearSeparators(),changeSeparator(),listTextarea.value){let e=/\W|_/gim,t=listTextarea.value.match(e);if(t&&t.length){let e=Helpers.RemoveDuplicates(t),a=[];e.forEach(e=>{let t={};e.match(/\t/gim)?(t.value="tab",t.innerHTML="Tab (\\t)"):e.match(/ /gim)?(t.value="space",t.innerHTML="Space ( )"):e.match(/[\r\n]+/gim)?(t.value="newline",t.innerHTML="New Line (\\n)"):(t.value=e,t.innerHTML=`${Separator.GetName(e)} (${e})`),t.innerHTML&&t.innerHTML.indexOf("undefined")<0&&a.push(t)}),clearSeparators(),Helpers.RemoveDuplicates(a,"value").forEach(function(e){let t=$create("option");t.value=e.value,t.innerHTML=e.innerHTML,separatorSelect.appendChild(t)}),setTimeout(()=>{separatorSelect.value="none"},50),separatorSelect.disabled=!1}}else Sort.Reset(),separatorSelect.disabled=!0,listTextarea.focus()},getElements=function(){searchTextCategory=$first("#searchTextCategory"),textCategories=$first("#textCategories"),categoryDetails=$first("#categoryDetails"),backButton=$first("#backButton"),textTypeOptionsContainer=$first("#textTypeOptionsContainer"),outputExample=$first("#outputExample"),localeContainer=$first("#localeContainer"),localeSelect=$first("#localeSelect"),prefixSuffix=$first("#prefixSuffix"),prefixSuffixEg=prefixSuffix.querySelector("#textExample > div"),prefixInput=prefixSuffix.querySelector("#prefixInput"),suffixInput=prefixSuffix.querySelector("#suffixInput"),addBtn=$first("#addBtn")},add=function(){editDocument({editLabel:"Add text to Repeat Grid"},async e=>{disableAll(!0),await RepeatGrid._rg.attachTextDataSeries(RepeatGrid.selectedItem.sceneNode,TextService.Sort(Sort.Get())),Usage.Apply(),disableAll(!1)})},filterSearchCategories=function(e){CATEGORIES.forEach(e=>{e.elm.style.display="block"}),CATEGORIES.forEach(e=>{e.contents.toLowerCase().search(this.value.trim().toLowerCase())>-1?e.elm.style.display="block":e.elm.style.display="none"})},showCategories=function(){selectedTextType=void 0,localeContainer.style.display="none",localeSelect.removeEventListener("change",changeLocale),categoryDetails.style.display="none",backButton.removeEventListener("click",showCategories),addBtn.removeEventListener("click",add),textCategories.style.display="flex";let e=$all(".text-category");CATEGORIES.length=0,e.forEach(e=>{e.addEventListener("click",hideCategories);let t=e.querySelector(".category-name").textContent.trim(),a=e.querySelector(".category-contents").textContent.split(", ").join(" ").trim();CATEGORIES.push({elm:e,contents:t+" "+a})}),searchTextCategory.addEventListener("input",filterSearchCategories),searchTextCategory.focus()},hideCategories=function(e){textCategories.style.display="hidden";let t=$all(".text-category");CATEGORIES.length=0,t.forEach(e=>{e.removeEventListener("click",hideCategories)}),searchTextCategory.removeEventListener("input",filterSearchCategories);let a=$first("#categoryName");categoryDetails.style.display="flex",backButton.addEventListener("click",showCategories),addBtn.addEventListener("click",add),e&&(a.innerHTML=this.getAttribute("data-name"),changeTextType(this.getAttribute("data-category"))),localeSelect.addEventListener("change",changeLocale)};function TextPanel(){}TextPanel.prototype.Create=function(e,t){Helpers.AddCSS("/partial/text/style.css"),Helpers.AddCSS("/partial/text/custom-list/custom-list-style.css"),Helpers.AddCSS("/partial/text/date/date-style.css"),this.Created=!0,gridSize=(RepeatGrid=e).rows*RepeatGrid.cols,faker.locale=Config.LOCALE,moment.locale(Config.LOCALE),Helpers.GetHtmlTemplate(view).then(e=>{t.innerHTML=e,Sort=new SortingService,getElements(),Object.keys(faker.locales).forEach(e=>{let t=$create("option");t.value=e,t.innerHTML=faker.locales[e].title,localeSelect.appendChild(t)}),localeSelect.value=Config.LOCALE,changeLocale.call(localeSelect),showCategories(),clearTexts()})},TextPanel.prototype.Destroy=function(){this.Created=!1,Sort=void 0,RepeatGrid=void 0,gridSize=void 0},module.exports=new TextPanel;