const os=require("os"),Helpers=require("../util/helpers"),MockService=require("../service/MockService"),Usage=require("../service/UsageService"),ReorderPanel=require("../partial/reorder/controller"),RepeatGrid=require("../service/RepeatGridService"),columnWidth=300;let UI,Mock,TheRepeatGrid,resizeListener,optionIndex,RGSelection,RGList,selectGridCell,repeatGridMock,changeRG,selectCell=function(){UI.ChangeItem(TheRepeatGrid)},drawRG=function(e){selectGridCell.innerHTML="",repeatGridMock.innerHTML="",Mock.FakeIt(TheRepeatGrid,{width:e,height:e},repeatGridMock,selectGridCell,selectCell,!0),Mock.SelectFirst(TheRepeatGrid)},resizeRG=function(e){Mock.Resize(TheRepeatGrid,{width:e,height:e})};function Reorder(){}Reorder.prototype.Show=async function(e){if(UI=new ReorderPanel,Mock=new MockService,resizeListener=!1,optionIndex=0,!UI.Created){e.node.firstChild&&e.node.firstChild.remove(),e.node.appendChild(await UI.Create());let i=await Helpers.GetUser();Usage.PanelOpen(i,os.platform())}},Reorder.prototype.Hide=function(e){e.node.firstChild&&e.node.firstChild.remove(),UI=void 0,Mock=void 0,TheRepeatGrid=void 0,Usage.PanelClose()},Reorder.prototype.Update=function(e){let i,t=Helpers.GetRGs(e);setTimeout(()=>{if(t.length){UI.Panel.className="show",UI.Warning.className="hide",RGSelection=$first("#RGSelection"),RGList=$first("#RGList"),selectGridCell=$first("#selectGridCell"),repeatGridMock=$first("#repeatGridMock"),1===t.length?RGSelection.style.display="none":RGSelection.style.display="block";let e,r=$first("#panelFlex"),n=UI.Panel.getBoundingClientRect().width;changeRG=function(){optionIndex=this.value,i=t[optionIndex],TheRepeatGrid&&TheRepeatGrid._rg.guid===i.guid||(TheRepeatGrid=new RepeatGrid(i),(n=UI.Panel.getBoundingClientRect().width)<300?(e=n,r.classList.remove("row"),r.classList.add("column")):(r.classList.remove("column"),r.classList.add("row"),setTimeout(()=>{e=selectGridCell.getBoundingClientRect().width},100)),setTimeout(()=>{drawRG(e)},100)),resizeListener||UI.Panel.addEventListener("resize",()=>{resizeListener=!0,UI.Panel.getBoundingClientRect().width!==n&&((n=UI.Panel.getBoundingClientRect().width)<300?(e=n,r.classList.remove("row"),r.classList.add("column")):(r.classList.remove("column"),r.classList.add("row"),e=selectGridCell.getBoundingClientRect().width),resizeRG(e))})},Helpers.MakeRGList(RGList,t,optionIndex,changeRG)}else UI.Panel.className="hide",UI.Warning.className="show",TheRepeatGrid=void 0},200)},module.exports=new Reorder;